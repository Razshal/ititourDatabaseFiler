<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Remplisseur de base de données</title>
    <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
    <script   src="https://code.jquery.com/jquery-2.2.4.js"
              integrity="sha256-iT6Q9iMJYuQiMWNd9lDyBUStIq/8PuOW33aOqmvFpqI="
              crossorigin="anonymous"></script>
    <style>
        html{
            font-family: Arial Black,Arial Bold,Gadget,sans-serif;
        }
        #chat{
            height: 60vh;
            overflow:auto;
            background-color: darkgray;
            font-size : 120%;
            padding-top: 1vh;
            margin-bottom: 20px;
            border-radius : 10px;
        }
        .post{
            margin-left: 10px;
        }
        table, th, td {
            border: 1px solid black;
            border-collapse: collapse;
            text-align: center;
            background-color: #f4f4f4;
        }

        input{
            width: 100%;
            padding: 12px 20px;
            margin: 8px 0;
            box-sizing: border-box;
            border: none;
            background-color: #e8eef0;
            color: black;
            resize:both;
        }
        #desc{
            width: 100%;
            padding: 12px 20px;
            margin: 8px 0;
            box-sizing: border-box;
            border: none;
            background-color: #e8eef0;
            color: black;
            resize:both;
        }
        #name,#note,#keywords,#villagesList,#sitesList,#desc,#send,#advices, #linkedDepartement, #linkedVille{
            display: none;
        }

        #send {
            background-color: #555555;
            color: white;
            margin: 10px;
        }
        #send:hover {
            background-color: white;
            color: black;
            border: 2px solid #555555;
        }

        #advicesButton:hover {
            background-color: white;
            color: black;
            border: 2px solid #555555;
        }
        #advicesButton {
            background-color: #555555;
            color: white;
            margin: 10px;
        }
        #advices{
            background-color: #b9b5b4;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 10px;
            color: #424040;
        }
        li{
            margin-top: 5px;
        }
        h1{
            text-align: center;
            border : 2px solid;
            border-radius: 10px;
            width:40vw;
            margin-right: auto;
            margin-left: auto;
            display: block;
        }
        h2{
            display: inline;
            position: inherit;
        }
        button{
            min-height: 30px;
            border: none;
        }

    </style>
</head>
    <body>
        <h1>Ititour Database Filler</h1>
        <h2>Test v0.3.0</h2>
        <input type="password" id="password" placeholder="Mot de passe d'accès au serveur">
        <form id="dataType">
            <table>Je veux ajouter un :
                <tr>
                    <th>Département</th>
                    <th>Ville/Village</th>
                    <th>Site touristique</th>
                </tr>
                <tr>
                    <td><input type="checkbox" id="isDepartement"></td>
                    <td><input type="checkbox" id="isVille"></td>
                    <td><input type="checkbox" id="isSite"></td>
                </tr>
            </table>
        </form>
        <form>
            <p id="fieldDesc"></p>
            <input type="text" placeholder="Le nom du departement/village/site" id="name">
            <input type="text" placeholder="Le nom du département où se situe cette ville/village" id="linkedDepartement">
            <input type="text" placeholder="Le nom de la ville où se situe ce site touristique" id="linkedVille">
            <input type="number" placeholder="Note de 0 à 5" id="note">
            <input type="text" placeholder="Mots clés (chaque mot clé doit être séparé par un espace)" id="keywords">
            <input type="text" placeholder="Liste des villes et villages du département séparés par un espace" id="villagesList">
            <input type="text" placeholder="Liste des sites touristiques de la ville/village séparés par une virgule" id="sitesList">
            <textarea id="desc" placeholder="Description de l'élément"></textarea>
            <button id="send">Envoyer directement dans la base de données</button>
        </form>

        <button id="advicesButton">Afficher la notice d'utilisation</button>
        <div id="advices">
            <h3>Bienvenue sur l'outil de remplissage de la base de données d'Ititour</h3>
            <ul>
                <li>Il est impératif de ne faire aucune faute sur aucun mot et de conserver la même orthographe majuscule et tirets compris pour chaque nom que vous utiliserez</li>
                <li>L'autre gros cadre gris en dessous vous montre les dernières données qui ont été rentrées</li>
                <li>La base de données va automatiquement associer les sites touristiques que vous entrerez dans
                les villes/villages mais pour celà il est nécéssaire que vous entriez le nom des sites avec la même orthographe
                même chose pour les villes dans la rubrique département</li>
                <li>Il n'y a aucune importance dans l'odre dans lequel vous entrez les données tant que le site web n'est pas en ligne</li>
                <li>Un site touristique peut être une cathédrale, un pont, un panorama, etc un point d'interrêt que vous souhaitez traiter</li>
                <li>Il faut décocher la case actuelle si vous voullez en choisir une autre</li>
            </ul>
        </div>

        <div id="chat"></div>
    </body>
</html>


<script>
    String.prototype.capitalizeFirstLetter = function() {
        return this.charAt(0).toUpperCase() + this.slice(1);
    };
    Array.prototype.fieldDataCorrectAfterSplit = function(){
        $.trim(this);
        for (thing in this){
            this[thing] = $.trim(this[thing]);
            this[thing] = this[thing].capitalizeFirstLetter();
        }
        return this;
    };
    var chat = document.getElementById('chat');
    var server = ('192.168.0.32:8080');
    var socket = io.connect(server);

    socket.on('lastDatas', function (data) {
        console.log('socket.on lastDatas : ' + data.datas);
        for(thing in data.datas) {
            for (subArray in data.datas[thing])
            postToChat(data.datas[thing][subArray]);
        }
    });
    var form = {descField: document.getElementById('desc'),
                nameField: document.getElementById('name'),
                linkedDepartementField: document.getElementById('linkedDepartement'),
                linkedVilleField: document.getElementById('linkedVille'),
                noteField : document.getElementById('note'),
                keywordsField : document.getElementById('keywords'),
                villesListField : document.getElementById('villagesList'),
                sitesListField : document.getElementById('sitesList'),
                send : document.getElementById('send')
    };
    var fieldDesc = document.getElementById('fieldDesc');
    var passwordField = document.getElementById('password');
    var dataTypeCheckboxes = document.getElementById('dataType');
    var isDepartement = document.getElementById('isDepartement');
    var isVille = document.getElementById('isVille');
    var isSite = document.getElementById('isSite');
    var advicesButton = document.getElementById('advicesButton');
    var advices = document.getElementById('advices');

    dataTypeCheckboxes.addEventListener('click', function () {
        if (isDepartement.checked || isVille.checked || isSite.checked){
            form.nameField.style.display = "inline";
            form.noteField.style.display = "inline";
            form.descField.style.display = "inline";
        }
        if (isDepartement.checked){
            form.villesListField.style.display = "inline";
            form.keywordsField.style.display = "none";
            form.sitesListField.style.display = "none";
            form.linkedDepartementField.style.display = "none";
            form.linkedVilleField.style.display = "none";
            form.send.style.display = "inline";
            fieldDesc.innerHTML = "Département";
            isVille.checked = false;
            isSite.checked = false;
        }
        else if (isVille.checked){
            form.linkedDepartementField.style.display = "inline";
            form.linkedVilleField.style.display = "none";
            form.villesListField.style.display = "none";
            form.keywordsField.style.display = "inline";
            form.sitesListField.style.display = "inline";
            form.send.style.display = "inline";
            fieldDesc.innerHTML = "Ville / Village";
            isSite.checked = false;
            isDepartement.checked = false;
        }
        else if (isSite.checked){
            form.villesListField.style.display = "none";
            form.keywordsField.style.display = "inline";
            form.sitesListField.style.display = "none";
            form.linkedDepartementField.style.display = "none";
            form.linkedVilleField.style.display = "inline";
            form.send.style.display = "inline";
            fieldDesc.innerHTML = "Site tourstique";
            isVille.checked = false;
            isDepartement.checked = false;
        }
        else {
            for(index in form) {
                form[index].style.display = "none";
            }
            fieldDesc.innerHTML = "";
        }
    });

    var isAdviceDisplayed = false;

    advicesButton.addEventListener('click', function (e) {
        e.preventDefault();
        isAdviceDisplayed = !isAdviceDisplayed;
        if (isAdviceDisplayed == true){
            advices.style.display = "inline-block";
        }
        else
            advices.style.display = "none";
    });
    form.send.addEventListener('click', function(e){
       pushIntoDatabase(form.nameField.value, form.noteField.value, form.keywordsField.value,
               form.descField.value, form.sitesListField.value, form.villesListField.value,
               form.linkedDepartementField.value, form.linkedVilleField.value);
        e.preventDefault();
    });

    function pageScroll() {
        chat.scrollTop = chat.scrollHeight;
    }
    
    function postToChat(data){
        var parag = document.createElement("p");
        parag.classList.add('post');
        parag.appendChild(document.createTextNode(data));
        chat.appendChild(parag);
        pageScroll();
    }

    function postDatasIntoChat(data){
        var parag = document.createElement("ul");
        parag.classList.add('datasFromDatabase');

        if (data.type == "Departement")
        {
            for (datasFromDb in data.datas) {
                var datasIntoChat = document.createElement("li");
                datasIntoChat.appendChild(document.createTextNode(data.datas[datasFromDb]));
                parag.appendChild(datasIntoChat);
            }
        }
        parag.appendChild(document.createTextNode(data));
        chat.appendChild(parag);
        pageScroll();
    }

    function pushIntoDatabase(name, note, keywords, desc, sites,
                              villes, linkedDepartement, linkedVille){
        if (parseInt(note) && name) {
            if (keywords) {
                keywords = keywords.split(" ");
                keywords.fieldDataCorrectAfterSplit();
            }
            if (villes) {
                villes = villes.split(" ");
                villes.fieldDataCorrectAfterSplit();
            }
            if (sites) {
                sites = sites.split(",");
                sites.fieldDataCorrectAfterSplit();
            }
            if (isSite.checked == true) {
                socket.emit('datasToPush', {
                    password: passwordField.value.toString(),
                    type: "Site",
                    name: name.toString(),
                    note: parseInt(note),
                    keywords: keywords,
                    linkedVilles: linkedVille,
                    desc: desc.toString()
                });
                postToChat("done site");
            }
            if (isVille.checked == true) {
                socket.emit('datasToPush', {
                    password: passwordField.value.toString(),
                    type: "Ville",
                    name: name.toString(),
                    note: parseInt(note),
                    keywords: keywords,
                    departement: linkedDepartement,
                    sites: sites,
                    desc: desc.toString()
                });
                postToChat("done ville");
            }
            if (isDepartement.checked == true) {
                socket.emit('datasToPush', {
                    password: passwordField.value.toString(),
                    type: "Departement",
                    name: name.toString(),
                    note: parseInt(note),
                    keywords: keywords,
                    villes: villes,
                    desc: desc.toString()
                });
                postToChat("done departement");
            }

        }
        else
            postToChat("Erreur dans les données renseignées ou le mot de passe, annulation de l'envoi en base de données")
    }



</script>