<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Remplisseur de base de données</title>
    <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
    <style>
        html{
            font-family: Arial Black,Arial Bold,Gadget,sans-serif;
        }
        #chat{
            height: 60vh;
            overflow:auto;
            background-color: darkgray;
            font-size : 120%;
            padding-top: 1vh;
            margin-bottom: 20px;
            border-radius : 10px;
        }
        .post{
            margin-left: 10px;
        }
        table, th, td {
            border: 1px solid black;
            border-collapse: collapse;
            text-align: center;
            background-color: #f4f4f4;
        }

        input{
            width: 100%;
            padding: 12px 20px;
            margin: 8px 0;
            box-sizing: border-box;
            border: none;
            background-color: #e8eef0;
            color: black;
            resize:both;
        }
        #desc{
            width: 100%;
            padding: 12px 20px;
            margin: 8px 0;
            box-sizing: border-box;
            border: none;
            background-color: #e8eef0;
            color: black;
            resize:both;
        }
        #name,#note,#keywords,#villagesList,#sitesList,#desc,#send,#advices, #linkedDepartement, #linkedVille{
            display: none;
        }

        #send {
            background-color: #555555;
            color: white;
            margin: 10px;
        }
        #send:hover {
            background-color: white;
            color: black;
            border: 2px solid #555555;
        }

        #advicesButton:hover {
            background-color: white;
            color: black;
            border: 2px solid #555555;
        }
        #advicesButton {
            background-color: #555555;
            color: white;
            margin: 10px;
        }
        #advices{
            background-color: #b9b5b4;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 10px;
            color: #424040;
        }
        li{
            margin-top: 5px;
        }
        h1{
            text-align: center;
            border : 2px solid;
            border-radius: 10px;
            width:40vw;
            margin-right: auto;
            margin-left: auto;
            display: block;
        }
        h2{
            display: inline;
            position: inherit;
        }

    </style>
</head>
    <body>
        <h1>Ititour Database Filler</h1>
        <h2>v0.2.0</h2>
        <form id="dataType">
            <table>
                <p>Je veux ajouter :</p>
                <tr>
                    <th>Département</th>
                    <th>Ville/Village</th>
                    <th>Site touristique</th>
                </tr>
                <tr>
                    <td><input type="checkbox" id="isDepartement"></td>
                    <td><input type="checkbox" id="isVille"></td>
                    <td><input type="checkbox" id="isSite"></td>
                </tr>
            </table>
        </form>
        <form>
            <p id="fieldDesc"></p>
            <input type="text" placeholder="Le nom du departement/village/site" id="name">
            <input type="text" placeholder="Le nom du département où se situe cette ville/village" id="linkedDepartement">
            <input type="text" placeholder="Le nom de la ville où se situe ce site touristique" id="linkedVille">
            <input type="number" placeholder="Note de 0 à 5" id="note">
            <input type="text" placeholder="Mots clés (chaque mot clé doit être séparé par un espace)" id="keywords">
            <input type="text" placeholder="Liste des villes et villages du département séparés par un espace et rien d'autre" id="villagesList">
            <input type="text" placeholder="Liste des sites touristiques de la ville/village séparés par un espace et rien d'autre" id="sitesList">
            <textarea id="desc" placeholder="Description de l'élément"></textarea>
            <button id="send">Envoyer directement dans la base de données</button>
        </form>

        <button id="advicesButton">Afficher la notice d'utilisation</button>
        <div id="advices">
            <h3>Bienvenue sur l'outil de remplissage de la base de données d'Ititour</h3>
            <ul>
                <li>Il est impératif de ne faire aucune faute sur aucun mot et de conserver la même orthographe majuscule et tirets compris pour chaque nom que vous utiliserez</li>
                <li>L'autre gros cadre gris en dessous vous montre les dernières données qui ont été rentrées</li>
                <li>La base de données va automatiquement associer les sites touristiques que vous entrerez dans
                les villes/villages mais pour celà il est nécéssaire que vous entriez le nom des sites avec la même orthographe
                même chose pour les villes dans la rubrique département</li>
                <li>Il n'y a aucune importance dans l'odre dans lequel vous entrez les données tant que le site web n'est pas en ligne</li>
                <li>Un site touristique peut être une cathédrale, un pont, un panorama, etc un point d'interrêt que vous souhaitez traiter</li>
                <li>Il faut décocher la case actuelle si vous voullez en choisir une autre</li>
            </ul>
        </div>

        <div id="chat"></div>
    </body>
</html>


<script>
    var chat = document.getElementById('chat');
    var server = ('192.168.0.32:8080');
    var socket = io.connect(server);

    socket.on('lastDatas', function (data) {
        console.log('socket.on lastDatas : ' + data.datas);
        for(arrays in data.datas) {
            postToChat(data.datas);
        }
    });
    var dataTypeCheckboxes = document.getElementById('dataType');
    var isDepartement = document.getElementById('isDepartement');
    var isVille = document.getElementById('isVille');
    var isSite = document.getElementById('isSite');
    var nameField = document.getElementById('name');
    var linkedDepartementField = document.getElementById('linkedDepartement');
    var linkedVilleField = document.getElementById('linkedVille');
    var noteField = document.getElementById('note');
    var keywordsField = document.getElementById('keywords');
    var villesListField = document.getElementById('villagesList');
    var sitesListField = document.getElementById('sitesList');
    var descField = document.getElementById('desc');
    var fieldDesc = document.getElementById('fieldDesc');
    var send = document.getElementById('send');
    var advicesButton = document.getElementById('advicesButton');
    var advices = document.getElementById('advices');

    dataTypeCheckboxes.addEventListener('click', function () {
        console.log('la bool est ' + isDepartement.checked);
        if (isDepartement.checked == true){
            nameField.style.display = "inline";
            noteField.style.display = "inline";
            descField.style.display = "inline";
            villesListField.style.display = "inline";
            keywordsField.style.display = "none";
            sitesListField.style.display = "none";
            linkedDepartementField.style.display = "none";
            linkedVilleField.style.display = "none";
            send.style.display = "inline";
            fieldDesc.innerHTML = "Département";
            isVille.checked = false;
            isSite.checked = false;
        }
        else if (isVille.checked == true){
            nameField.style.display = "inline";
            noteField.style.display = "inline";
            descField.style.display = "inline";
            linkedDepartementField.style.display = "inline";
            linkedVilleField.style.display = "none";
            villesListField.style.display = "none";
            keywordsField.style.display = "inline";
            sitesListField.style.display = "inline";
            send.style.display = "inline";
            fieldDesc.innerHTML = "Ville / Village";
            isSite.checked = false;
            isDepartement.checked = false;
        }
        else if (isSite.checked == true){
            nameField.style.display = "inline";
            noteField.style.display = "inline";
            descField.style.display = "inline";
            villesListField.style.display = "none";
            keywordsField.style.display = "inline";
            sitesListField.style.display = "none";
            linkedDepartementField.style.display = "none";
            linkedVilleField.style.display = "inline";
            send.style.display = "inline";
            fieldDesc.innerHTML = "Site tourstique";
            isVille.checked = false;
            isDepartement.checked = false;
        }
        else {
            nameField.style.display = "none";
            noteField.style.display = "none";
            descField.style.display = "none";
            villesListField.style.display = "none";
            keywordsField.style.display = "none";
            sitesListField.style.display = "none";
            linkedDepartementField.style.display = "none";
            linkedVilleField.style.display = "none";
            send.style.display = "none";
            fieldDesc.innerHTML = "";
        }
    });

    var isAdviceDisplayed = false;

    advicesButton.addEventListener('click', function (e) {
        e.preventDefault();
        isAdviceDisplayed = !isAdviceDisplayed;
        if (isAdviceDisplayed == true){
            advices.style.display = "inline-block";
        }
        else
            advices.style.display = "none";
    });
    send.addEventListener('click', function(e){
       pushIntoDatabase(nameField.value, noteField.value, keywordsField.value, descField.value, sitesListField.value, villesListField.value, linkedDepartementField.value, linkedVilleField.value);
        e.preventDefault();
    });


    function pageScroll() {
        chat.scrollTop = chat.scrollHeight;
    }

    function postToChat(data){
        var parag = document.createElement("p");
        parag.classList.add('post');

            parag.appendChild(document.createTextNode(data));

        chat.appendChild(parag);
        pageScroll();
    }

    function pushIntoDatabase(name, note, keywords, desc, sites, villes, linkedDepartement, linkedVille){
        if (parseInt(note) && name) {
            if (keywords) {
                keywords = keywords.split(" ");
                console.log(keywords);
            }
            if (villes) {
                villes = villes.split(" ");
                console.log(villes);
            }
            if (sites) {
                sites = sites.split(" ");
                console.log(sites);
            }
            if (isSite.checked == true) {
                socket.emit('datasToPush', {
                    type: "Site",
                    name: name.toString(),
                    note: parseInt(note),
                    keywords: keywords,
                    linkedVilles: linkedVille,
                    desc: desc.toString()
                })
                console.log("done site");
            }
            if (isVille.checked == true) {
                socket.emit('datasToPush', {
                    type: "Ville",
                    name: name.toString(),
                    note: parseInt(note),
                    keywords: keywords,
                    departement: linkedDepartement,
                    desc: desc.toString()
                })
                console.log("done ville");
            }
            if (isDepartement.checked == true) {
                socket.emit('datasToPush', {
                    type: "Departement",
                    name: name.toString(),
                    note: parseInt(note),
                    keywords: keywords,
                    villes: villes,
                    desc: desc.toString()
                })
                console.log("done departement");
            }

        }
        else
            postToChat("Erreur dans les données renseignées, annulation de l'envoi en base de données")
    }



</script>